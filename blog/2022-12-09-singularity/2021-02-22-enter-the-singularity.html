<!DOCTYPE html>
<html lang="en">
<head>
<!-- 2023-03-25 Sat 17:14 -->
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Enter the Singularity Or Containers for Reproducible Research Environments</title>
<meta name="generator" content="Org mode">
<meta name="author" content="Jay Morgan">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<link rel="stylesheet" type="text/css" href="/css/general.css"/>
<script type="text/javascript">
// @license magnet:?xt=urn:btih:e95b018ef3580986a04669f1b5879592219e2a7a&dn=public-domain.txt Public Domain
<!--/*--><![CDATA[/*><!--*/
     function CodeHighlightOn(elem, id)
     {
       var target = document.getElementById(id);
       if(null != target) {
         elem.classList.add("code-highlighted");
         target.classList.add("code-highlighted");
       }
     }
     function CodeHighlightOff(elem, id)
     {
       var target = document.getElementById(id);
       if(null != target) {
         elem.classList.remove("code-highlighted");
         target.classList.remove("code-highlighted");
       }
     }
    /*]]>*///-->
// @license-end
</script>
</head>
<body>
<div id="preamble" class="status">
<h1 class="title">Enter the Singularity Or Containers for Reproducible Research Environments</h1>
          <p class="subtitle">22-02-2021</p>
</div>
<div id="content">
<h1 class="title">Enter the Singularity Or Containers for Reproducible Research Environments</h1>
<div id="table-of-contents">
<h2>Table of Contents</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="#org69af8fe">1. Why not Docker?</a></li>
</ul>
</div>
</div>
<div id="topbar">
<img id="profile-picture" src="/images/profile.jpg" alt="Jay Paul Morgan profile picture" width="200px"/>
<h3>Dr. Jay Paul Morgan</h3>
<a href="/">About</a>
<a href="/blog">Blog Posts</a>
<a href="/news">News</a>
<a href="https://pageperso.lis-lab.fr/jay.morgan/teaching.html">Teaching</a>
<p id="social-links">
<a href="https://scholar.google.com/citations?user=AO1az5YAAAAJ&hl=fr"><img src="/images/google-scholar.png" alt="Jay Paul Morgan google scholar publication" width="30px" height="30px"/></a>
<a href="https://emacs.ch/@jaymorgan"><img src="/images/mastodon.png" alt="Jay Paul Morgan Mastodon" width="30px" height="30px"/></a>
<a href="https://github.com/jaypmorgan"><img src="/images/github.png" alt="Jay Paul Morgan jaypmorgan github link" width="30px" height="30px"/></a>
<a href="https://orcid.org/my-orcid?orcid=0000-0003-3719-362X"><img src="/images/orcid.png" alt="Jay Paul Morgan orcid link" width="30px" height="30px"/></a>
<a href="https://www.researchgate.net/profile/Jay-Morgan?ev=hdr_xprf"><img src="/images/researchgate.png" alt="Jay Paul Morgan research gate social link" width="30px" height="30px"/></a>
</p>
</div>

<p>
We must have all said at some point 'But it works on my machine'. The intricacies and
details surrounding some program that <i>should</i> work on another machines, but ultimately
doesn't. Docker solves this problem in business environments by shipping your
machine, and maybe this method is a brilliant stop-gap solution until something
better comes on.
</p>

<p>
Here in Academia, we face a similar issue with reproducility of results. In this blog
post, I want to discuss one method to help us make our results <i>more</i>
reproducible. This solution is not a panacea, not by any means.
</p>

<pre class="example">
Bootstrap: docker
From: nvidia/cuda:10.0-devel

%help
	A container for machine learning

%labels
	Maintainer Jay Morgan
	Version v1.0.0

%environment
	export SHOME="/singularity-point";
	export CUDA_HOME=/usr/local/cuda;
	export LD_LIBRARY_PATH=${LD_LIBRARY_PATH}:${CUDA_HOME}/lib64;
	PATH=${CUDA_HOME}/bin:${PATH};
	export PATH;

%files
	environment.yml /home/
	scripts/install-conda-environment.sh /home/

%post
	export SHOME="/singularity-point";
	export TZ=Europe/London
	export DEBIAN_FRONTEND=noninteractive
	export LC_ALL=C.UTF-8

	mkdir $SHOME &amp;&amp; cd $SHOME;
	mv /home/*.yml $SHOME/;
	mv /home/*.sh $SHOME/;

	apt-get update &amp;&amp; apt-get -y upgrade
	apt-get -y install \
		build-essential \
		software-properties-common \
		dirmngr \
		wget \
		git \
		curl \
		cmake \
		libxml2-dev \
		libssl-dev \
		libcurl4-openssl-dev \
		libfontconfig1-dev \
		libhdf5-dev \
		libsm6
	apt-get clean

	# install miniconda
	wget https://repo.anaconda.com/miniconda/Miniconda3-latest-Linux-x86_64.sh \
	     &amp;&amp; bash Miniconda3-latest-Linux-x86_64.sh -b -p "$SHOME/conda" \
	     &amp;&amp; rm -f Miniconda3-latest-Linux-x86_64.sh
	# create the python environment
	export PATH=${SHOME}/conda/bin:${PATH}
	bash $SHOME/install-conda-environment.sh

%apprun python
	export CUBLAS_WORKSPACE_CONFIG=:4096:8  # deterministic behaviour
	# assumes project is mounted to /mnt
	cd /mnt
	exec /singularity-point/conda/envs/presage/bin/python "$@"

%apprun ipython
	cd /mnt
	exec /singularity-point/conda/envs/presage/bin/ipython "$@"

%runscript
	shopt -s expand_aliases
	cd /mnt
	alias python="$SHOME/conda/envs/presage/bin/python"
	alias ipython="$SHOME/conda/envs/presage/bin/ipython"
	exec "$@"
</pre>

<div id="outline-container-org69af8fe" class="outline-2">
<h2 id="org69af8fe"><span class="section-number-2">1</span> Why not Docker?</h2>
<div class="outline-text-2" id="text-1">
<p>
Docker is great for business environments. In these environments, our builds,
servers, are something that we own and have root access. 
</p>
</div>
</div>
</div>
<div id="postamble" class="status">
<p class="date">Date: 22-02-2021</p>
<p class="author">Author: Jay Morgan</p>
<p class="date">Created: 2023-03-25 Sat 17:14</p>
<p class="validation"><a href="https://validator.w3.org/check?uri=referer">Validate</a></p>
</div>
</body>
</html>
